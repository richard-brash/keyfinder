"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/spotify/playlists";
exports.ids = ["pages/api/spotify/playlists"];
exports.modules = {

/***/ "cookie":
/*!*************************!*\
  !*** external "cookie" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("cookie");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "pg":
/*!*********************!*\
  !*** external "pg" ***!
  \*********************/
/***/ ((module) => {

module.exports = import("pg");;

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fspotify%2Fplaylists&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cspotify%5Cplaylists%5Cindex.ts&middlewareConfigBase64=e30%3D!":
/*!****************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fspotify%2Fplaylists&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cspotify%5Cplaylists%5Cindex.ts&middlewareConfigBase64=e30%3D! ***!
  \****************************************************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_spotify_playlists_index_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages\\api\\spotify\\playlists\\index.ts */ \"(api)/./pages/api/spotify/playlists/index.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_pages_api_spotify_playlists_index_ts__WEBPACK_IMPORTED_MODULE_3__]);\n_pages_api_spotify_playlists_index_ts__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_spotify_playlists_index_ts__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_spotify_playlists_index_ts__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/spotify/playlists\",\n        pathname: \"/api/spotify/playlists\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_spotify_playlists_index_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRnNwb3RpZnklMkZwbGF5bGlzdHMmcHJlZmVycmVkUmVnaW9uPSZhYnNvbHV0ZVBhZ2VQYXRoPS4lMkZwYWdlcyU1Q2FwaSU1Q3Nwb3RpZnklNUNwbGF5bGlzdHMlNUNpbmRleC50cyZtaWRkbGV3YXJlQ29uZmlnQmFzZTY0PWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDTDtBQUMxRDtBQUN1RTtBQUN2RTtBQUNBLGlFQUFlLHdFQUFLLENBQUMsa0VBQVEsWUFBWSxFQUFDO0FBQzFDO0FBQ08sZUFBZSx3RUFBSyxDQUFDLGtFQUFRO0FBQ3BDO0FBQ08sd0JBQXdCLGdIQUFtQjtBQUNsRDtBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxZQUFZO0FBQ1osQ0FBQzs7QUFFRCxxQyIsInNvdXJjZXMiOlsid2VicGFjazovL2tleWZpbmRlci8/NmE1NyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQYWdlc0FQSVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvcGFnZXMtYXBpL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IGhvaXN0IH0gZnJvbSBcIm5leHQvZGlzdC9idWlsZC90ZW1wbGF0ZXMvaGVscGVyc1wiO1xuLy8gSW1wb3J0IHRoZSB1c2VybGFuZCBjb2RlLlxuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi4vcGFnZXNcXFxcYXBpXFxcXHNwb3RpZnlcXFxccGxheWxpc3RzXFxcXGluZGV4LnRzXCI7XG4vLyBSZS1leHBvcnQgdGhlIGhhbmRsZXIgKHNob3VsZCBiZSB0aGUgZGVmYXVsdCBleHBvcnQpLlxuZXhwb3J0IGRlZmF1bHQgaG9pc3QodXNlcmxhbmQsIFwiZGVmYXVsdFwiKTtcbi8vIFJlLWV4cG9ydCBjb25maWcuXG5leHBvcnQgY29uc3QgY29uZmlnID0gaG9pc3QodXNlcmxhbmQsIFwiY29uZmlnXCIpO1xuLy8gQ3JlYXRlIGFuZCBleHBvcnQgdGhlIHJvdXRlIG1vZHVsZSB0aGF0IHdpbGwgYmUgY29uc3VtZWQuXG5leHBvcnQgY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgUGFnZXNBUElSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuUEFHRVNfQVBJLFxuICAgICAgICBwYWdlOiBcIi9hcGkvc3BvdGlmeS9wbGF5bGlzdHNcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9zcG90aWZ5L3BsYXlsaXN0c1wiLFxuICAgICAgICAvLyBUaGUgZm9sbG93aW5nIGFyZW4ndCB1c2VkIGluIHByb2R1Y3Rpb24uXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcIlwiXG4gICAgfSxcbiAgICB1c2VybGFuZFxufSk7XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXBhZ2VzLWFwaS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fspotify%2Fplaylists&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cspotify%5Cplaylists%5Cindex.ts&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./lib/db.ts":
/*!*******************!*\
  !*** ./lib/db.ts ***!
  \*******************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ensureSchema: () => (/* binding */ ensureSchema),\n/* harmony export */   pool: () => (/* binding */ pool)\n/* harmony export */ });\n/* harmony import */ var pg__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! pg */ \"pg\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([pg__WEBPACK_IMPORTED_MODULE_0__]);\npg__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\nconst connectionString = process.env.DATABASE_URL || \"\";\nif (!connectionString) {\n// During local dev we may not have a DB; code should handle missing DB gracefully.\n// When deploying to Railway, set DATABASE_URL.\n}\nconst pool = new pg__WEBPACK_IMPORTED_MODULE_0__.Pool({\n    connectionString\n});\nasync function ensureSchema() {\n    if (!connectionString) return;\n    await pool.query(`\r\n    CREATE TABLE IF NOT EXISTS users (\r\n      id SERIAL PRIMARY KEY,\r\n      spotify_id TEXT UNIQUE NOT NULL,\r\n      refresh_token TEXT,\r\n      updated_at TIMESTAMP WITH TIME ZONE DEFAULT now()\r\n    );\r\n  `);\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9saWIvZGIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQTBCO0FBRTFCLE1BQU1DLG1CQUFtQkMsUUFBUUMsR0FBRyxDQUFDQyxZQUFZLElBQUk7QUFFckQsSUFBSSxDQUFDSCxrQkFBa0I7QUFDckIsbUZBQW1GO0FBQ25GLCtDQUErQztBQUNqRDtBQUVPLE1BQU1JLE9BQU8sSUFBSUwsb0NBQUlBLENBQUM7SUFBRUM7QUFBaUIsR0FBRztBQUU1QyxlQUFlSztJQUNwQixJQUFJLENBQUNMLGtCQUFrQjtJQUN2QixNQUFNSSxLQUFLRSxLQUFLLENBQUMsQ0FBQzs7Ozs7OztFQU9sQixDQUFDO0FBQ0giLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9rZXlmaW5kZXIvLi9saWIvZGIudHM/MWRmMCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQb29sIH0gZnJvbSAncGcnO1xyXG5cclxuY29uc3QgY29ubmVjdGlvblN0cmluZyA9IHByb2Nlc3MuZW52LkRBVEFCQVNFX1VSTCB8fCAnJztcclxuXHJcbmlmICghY29ubmVjdGlvblN0cmluZykge1xyXG4gIC8vIER1cmluZyBsb2NhbCBkZXYgd2UgbWF5IG5vdCBoYXZlIGEgREI7IGNvZGUgc2hvdWxkIGhhbmRsZSBtaXNzaW5nIERCIGdyYWNlZnVsbHkuXHJcbiAgLy8gV2hlbiBkZXBsb3lpbmcgdG8gUmFpbHdheSwgc2V0IERBVEFCQVNFX1VSTC5cclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IHBvb2wgPSBuZXcgUG9vbCh7IGNvbm5lY3Rpb25TdHJpbmcgfSk7XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZW5zdXJlU2NoZW1hKCkge1xyXG4gIGlmICghY29ubmVjdGlvblN0cmluZykgcmV0dXJuO1xyXG4gIGF3YWl0IHBvb2wucXVlcnkoYFxyXG4gICAgQ1JFQVRFIFRBQkxFIElGIE5PVCBFWElTVFMgdXNlcnMgKFxyXG4gICAgICBpZCBTRVJJQUwgUFJJTUFSWSBLRVksXHJcbiAgICAgIHNwb3RpZnlfaWQgVEVYVCBVTklRVUUgTk9UIE5VTEwsXHJcbiAgICAgIHJlZnJlc2hfdG9rZW4gVEVYVCxcclxuICAgICAgdXBkYXRlZF9hdCBUSU1FU1RBTVAgV0lUSCBUSU1FIFpPTkUgREVGQVVMVCBub3coKVxyXG4gICAgKTtcclxuICBgKTtcclxufVxyXG4iXSwibmFtZXMiOlsiUG9vbCIsImNvbm5lY3Rpb25TdHJpbmciLCJwcm9jZXNzIiwiZW52IiwiREFUQUJBU0VfVVJMIiwicG9vbCIsImVuc3VyZVNjaGVtYSIsInF1ZXJ5Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./lib/db.ts\n");

/***/ }),

/***/ "(api)/./lib/spotify.ts":
/*!************************!*\
  !*** ./lib/spotify.ts ***!
  \************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getAccessTokenForUser: () => (/* binding */ getAccessTokenForUser),\n/* harmony export */   keyToPitch: () => (/* binding */ keyToPitch)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./db */ \"(api)/./lib/db.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_db__WEBPACK_IMPORTED_MODULE_0__]);\n_db__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\nfunction keyToPitch(key, mode) {\n    if (key === null || key === undefined) return \"Unknown\";\n    const names = [\n        \"C\",\n        \"C#\",\n        \"D\",\n        \"D#\",\n        \"E\",\n        \"F\",\n        \"F#\",\n        \"G\",\n        \"G#\",\n        \"A\",\n        \"A#\",\n        \"B\"\n    ];\n    const k = names[key % 12];\n    if (mode === 1) return `${k} major`;\n    if (mode === 0) return `${k} minor`;\n    return `${k}`;\n}\nasync function getAccessTokenForUser(spotifyId) {\n    if (!process.env.DATABASE_URL) return null;\n    const r = await _db__WEBPACK_IMPORTED_MODULE_0__.pool.query(\"SELECT refresh_token FROM users WHERE spotify_id = $1\", [\n        spotifyId\n    ]);\n    if (!r.rows || r.rows.length === 0) return null;\n    const refreshToken = r.rows[0].refresh_token;\n    if (!refreshToken) return null;\n    const clientId = process.env.SPOTIFY_CLIENT_ID;\n    const clientSecret = process.env.SPOTIFY_CLIENT_SECRET;\n    const basic = Buffer.from(`${clientId}:${clientSecret}`).toString(\"base64\");\n    const body = new URLSearchParams({\n        grant_type: \"refresh_token\",\n        refresh_token: refreshToken\n    });\n    const resp = await fetch(\"https://accounts.spotify.com/api/token\", {\n        method: \"POST\",\n        headers: {\n            Authorization: `Basic ${basic}`,\n            \"Content-Type\": \"application/x-www-form-urlencoded\"\n        },\n        body: body.toString()\n    });\n    const json = await resp.json();\n    if (json.error) throw new Error(\"Failed to refresh token: \" + JSON.stringify(json));\n    const accessToken = json.access_token;\n    const newRefresh = json.refresh_token;\n    if (newRefresh) {\n        await _db__WEBPACK_IMPORTED_MODULE_0__.pool.query(\"UPDATE users SET refresh_token = $1, updated_at = now() WHERE spotify_id = $2\", [\n            newRefresh,\n            spotifyId\n        ]);\n    }\n    return accessToken || null;\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9saWIvc3BvdGlmeS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBNEI7QUFFckIsU0FBU0MsV0FBV0MsR0FBa0IsRUFBRUMsSUFBbUI7SUFDaEUsSUFBSUQsUUFBUSxRQUFRQSxRQUFRRSxXQUFXLE9BQU87SUFDOUMsTUFBTUMsUUFBUTtRQUFDO1FBQUk7UUFBSztRQUFJO1FBQUs7UUFBSTtRQUFJO1FBQUs7UUFBSTtRQUFLO1FBQUk7UUFBSztLQUFJO0lBQ3BFLE1BQU1DLElBQUlELEtBQUssQ0FBQ0gsTUFBTSxHQUFHO0lBQ3pCLElBQUlDLFNBQVMsR0FBRyxPQUFPLENBQUMsRUFBRUcsRUFBRSxNQUFNLENBQUM7SUFDbkMsSUFBSUgsU0FBUyxHQUFHLE9BQU8sQ0FBQyxFQUFFRyxFQUFFLE1BQU0sQ0FBQztJQUNuQyxPQUFPLENBQUMsRUFBRUEsRUFBRSxDQUFDO0FBQ2Y7QUFFTyxlQUFlQyxzQkFBc0JDLFNBQWlCO0lBQzNELElBQUksQ0FBQ0MsUUFBUUMsR0FBRyxDQUFDQyxZQUFZLEVBQUUsT0FBTztJQUV0QyxNQUFNQyxJQUFJLE1BQU1aLHFDQUFJQSxDQUFDYSxLQUFLLENBQUMseURBQXlEO1FBQUNMO0tBQVU7SUFDL0YsSUFBSSxDQUFDSSxFQUFFRSxJQUFJLElBQUlGLEVBQUVFLElBQUksQ0FBQ0MsTUFBTSxLQUFLLEdBQUcsT0FBTztJQUMzQyxNQUFNQyxlQUFlSixFQUFFRSxJQUFJLENBQUMsRUFBRSxDQUFDRyxhQUFhO0lBQzVDLElBQUksQ0FBQ0QsY0FBYyxPQUFPO0lBRTFCLE1BQU1FLFdBQVdULFFBQVFDLEdBQUcsQ0FBQ1MsaUJBQWlCO0lBQzlDLE1BQU1DLGVBQWVYLFFBQVFDLEdBQUcsQ0FBQ1cscUJBQXFCO0lBQ3RELE1BQU1DLFFBQVFDLE9BQU9DLElBQUksQ0FBQyxDQUFDLEVBQUVOLFNBQVMsQ0FBQyxFQUFFRSxhQUFhLENBQUMsRUFBRUssUUFBUSxDQUFDO0lBQ2xFLE1BQU1DLE9BQU8sSUFBSUMsZ0JBQWdCO1FBQUVDLFlBQVk7UUFBaUJYLGVBQWVEO0lBQWE7SUFFNUYsTUFBTWEsT0FBTyxNQUFNQyxNQUFNLDBDQUEwQztRQUNqRUMsUUFBUTtRQUNSQyxTQUFTO1lBQUVDLGVBQWUsQ0FBQyxNQUFNLEVBQUVYLE1BQU0sQ0FBQztZQUFFLGdCQUFnQjtRQUFvQztRQUNoR0ksTUFBTUEsS0FBS0QsUUFBUTtJQUNyQjtJQUVBLE1BQU1TLE9BQU8sTUFBTUwsS0FBS0ssSUFBSTtJQUM1QixJQUFJQSxLQUFLQyxLQUFLLEVBQUUsTUFBTSxJQUFJQyxNQUFNLDhCQUE4QkMsS0FBS0MsU0FBUyxDQUFDSjtJQUU3RSxNQUFNSyxjQUFjTCxLQUFLTSxZQUFZO0lBQ3JDLE1BQU1DLGFBQWFQLEtBQUtqQixhQUFhO0lBRXJDLElBQUl3QixZQUFZO1FBQ2QsTUFBTXpDLHFDQUFJQSxDQUFDYSxLQUFLLENBQUMsaUZBQWlGO1lBQUM0QjtZQUFZakM7U0FBVTtJQUMzSDtJQUVBLE9BQU8rQixlQUFlO0FBQ3hCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8va2V5ZmluZGVyLy4vbGliL3Nwb3RpZnkudHM/MzlmZiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBwb29sIH0gZnJvbSAnLi9kYic7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24ga2V5VG9QaXRjaChrZXk6IG51bWJlciB8IG51bGwsIG1vZGU6IG51bWJlciB8IG51bGwpIHtcclxuICBpZiAoa2V5ID09PSBudWxsIHx8IGtleSA9PT0gdW5kZWZpbmVkKSByZXR1cm4gJ1Vua25vd24nO1xyXG4gIGNvbnN0IG5hbWVzID0gWydDJywnQyMnLCdEJywnRCMnLCdFJywnRicsJ0YjJywnRycsJ0cjJywnQScsJ0EjJywnQiddO1xyXG4gIGNvbnN0IGsgPSBuYW1lc1trZXkgJSAxMl07XHJcbiAgaWYgKG1vZGUgPT09IDEpIHJldHVybiBgJHtrfSBtYWpvcmA7XHJcbiAgaWYgKG1vZGUgPT09IDApIHJldHVybiBgJHtrfSBtaW5vcmA7XHJcbiAgcmV0dXJuIGAke2t9YDtcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEFjY2Vzc1Rva2VuRm9yVXNlcihzcG90aWZ5SWQ6IHN0cmluZyk6IFByb21pc2U8c3RyaW5nIHwgbnVsbD4ge1xyXG4gIGlmICghcHJvY2Vzcy5lbnYuREFUQUJBU0VfVVJMKSByZXR1cm4gbnVsbDtcclxuXHJcbiAgY29uc3QgciA9IGF3YWl0IHBvb2wucXVlcnkoJ1NFTEVDVCByZWZyZXNoX3Rva2VuIEZST00gdXNlcnMgV0hFUkUgc3BvdGlmeV9pZCA9ICQxJywgW3Nwb3RpZnlJZF0pO1xyXG4gIGlmICghci5yb3dzIHx8IHIucm93cy5sZW5ndGggPT09IDApIHJldHVybiBudWxsO1xyXG4gIGNvbnN0IHJlZnJlc2hUb2tlbiA9IHIucm93c1swXS5yZWZyZXNoX3Rva2VuIGFzIHN0cmluZyB8IG51bGw7XHJcbiAgaWYgKCFyZWZyZXNoVG9rZW4pIHJldHVybiBudWxsO1xyXG5cclxuICBjb25zdCBjbGllbnRJZCA9IHByb2Nlc3MuZW52LlNQT1RJRllfQ0xJRU5UX0lEO1xyXG4gIGNvbnN0IGNsaWVudFNlY3JldCA9IHByb2Nlc3MuZW52LlNQT1RJRllfQ0xJRU5UX1NFQ1JFVDtcclxuICBjb25zdCBiYXNpYyA9IEJ1ZmZlci5mcm9tKGAke2NsaWVudElkfToke2NsaWVudFNlY3JldH1gKS50b1N0cmluZygnYmFzZTY0Jyk7XHJcbiAgY29uc3QgYm9keSA9IG5ldyBVUkxTZWFyY2hQYXJhbXMoeyBncmFudF90eXBlOiAncmVmcmVzaF90b2tlbicsIHJlZnJlc2hfdG9rZW46IHJlZnJlc2hUb2tlbiB9KTtcclxuXHJcbiAgY29uc3QgcmVzcCA9IGF3YWl0IGZldGNoKCdodHRwczovL2FjY291bnRzLnNwb3RpZnkuY29tL2FwaS90b2tlbicsIHtcclxuICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgaGVhZGVyczogeyBBdXRob3JpemF0aW9uOiBgQmFzaWMgJHtiYXNpY31gLCAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCcgfSxcclxuICAgIGJvZHk6IGJvZHkudG9TdHJpbmcoKVxyXG4gIH0pO1xyXG5cclxuICBjb25zdCBqc29uID0gYXdhaXQgcmVzcC5qc29uKCk7XHJcbiAgaWYgKGpzb24uZXJyb3IpIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIHJlZnJlc2ggdG9rZW46ICcgKyBKU09OLnN0cmluZ2lmeShqc29uKSk7XHJcblxyXG4gIGNvbnN0IGFjY2Vzc1Rva2VuID0ganNvbi5hY2Nlc3NfdG9rZW4gYXMgc3RyaW5nIHwgdW5kZWZpbmVkO1xyXG4gIGNvbnN0IG5ld1JlZnJlc2ggPSBqc29uLnJlZnJlc2hfdG9rZW4gYXMgc3RyaW5nIHwgdW5kZWZpbmVkO1xyXG5cclxuICBpZiAobmV3UmVmcmVzaCkge1xyXG4gICAgYXdhaXQgcG9vbC5xdWVyeSgnVVBEQVRFIHVzZXJzIFNFVCByZWZyZXNoX3Rva2VuID0gJDEsIHVwZGF0ZWRfYXQgPSBub3coKSBXSEVSRSBzcG90aWZ5X2lkID0gJDInLCBbbmV3UmVmcmVzaCwgc3BvdGlmeUlkXSk7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gYWNjZXNzVG9rZW4gfHwgbnVsbDtcclxufVxyXG4iXSwibmFtZXMiOlsicG9vbCIsImtleVRvUGl0Y2giLCJrZXkiLCJtb2RlIiwidW5kZWZpbmVkIiwibmFtZXMiLCJrIiwiZ2V0QWNjZXNzVG9rZW5Gb3JVc2VyIiwic3BvdGlmeUlkIiwicHJvY2VzcyIsImVudiIsIkRBVEFCQVNFX1VSTCIsInIiLCJxdWVyeSIsInJvd3MiLCJsZW5ndGgiLCJyZWZyZXNoVG9rZW4iLCJyZWZyZXNoX3Rva2VuIiwiY2xpZW50SWQiLCJTUE9USUZZX0NMSUVOVF9JRCIsImNsaWVudFNlY3JldCIsIlNQT1RJRllfQ0xJRU5UX1NFQ1JFVCIsImJhc2ljIiwiQnVmZmVyIiwiZnJvbSIsInRvU3RyaW5nIiwiYm9keSIsIlVSTFNlYXJjaFBhcmFtcyIsImdyYW50X3R5cGUiLCJyZXNwIiwiZmV0Y2giLCJtZXRob2QiLCJoZWFkZXJzIiwiQXV0aG9yaXphdGlvbiIsImpzb24iLCJlcnJvciIsIkVycm9yIiwiSlNPTiIsInN0cmluZ2lmeSIsImFjY2Vzc1Rva2VuIiwiYWNjZXNzX3Rva2VuIiwibmV3UmVmcmVzaCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./lib/spotify.ts\n");

/***/ }),

/***/ "(api)/./pages/api/spotify/playlists/index.ts":
/*!**********************************************!*\
  !*** ./pages/api/spotify/playlists/index.ts ***!
  \**********************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var cookie__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! cookie */ \"cookie\");\n/* harmony import */ var cookie__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(cookie__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _lib_spotify__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../lib/spotify */ \"(api)/./lib/spotify.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_lib_spotify__WEBPACK_IMPORTED_MODULE_1__]);\n_lib_spotify__WEBPACK_IMPORTED_MODULE_1__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\nasync function fetchWithToken(url, token) {\n    const resp = await fetch(url, {\n        headers: {\n            Authorization: `Bearer ${token}`\n        }\n    });\n    return resp.json();\n}\nasync function handler(req, res) {\n    const cookies = cookie__WEBPACK_IMPORTED_MODULE_0___default().parse(req.headers.cookie || \"\");\n    const userId = cookies.user_id;\n    // local-dev fallback to access_token cookie\n    const localAccess = cookies.access_token;\n    let token = null;\n    if (userId) {\n        token = await (0,_lib_spotify__WEBPACK_IMPORTED_MODULE_1__.getAccessTokenForUser)(userId);\n    }\n    if (!token && localAccess) token = localAccess;\n    if (!token) return res.status(401).json({\n        error: \"not_authenticated\"\n    });\n    const data = await fetchWithToken(\"https://api.spotify.com/v1/me/playlists?limit=50\", token);\n    res.status(200).json(data);\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9wYWdlcy9hcGkvc3BvdGlmeS9wbGF5bGlzdHMvaW5kZXgudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUM0QjtBQUNvQztBQUVoRSxlQUFlRSxlQUFlQyxHQUFXLEVBQUVDLEtBQWE7SUFDdEQsTUFBTUMsT0FBTyxNQUFNQyxNQUFNSCxLQUFLO1FBQUVJLFNBQVM7WUFBRUMsZUFBZSxDQUFDLE9BQU8sRUFBRUosTUFBTSxDQUFDO1FBQUM7SUFBRTtJQUM5RSxPQUFPQyxLQUFLSSxJQUFJO0FBQ2xCO0FBRWUsZUFBZUMsUUFBUUMsR0FBbUIsRUFBRUMsR0FBb0I7SUFDN0UsTUFBTUMsVUFBVWIsbURBQVksQ0FBQ1csSUFBSUosT0FBTyxDQUFDUCxNQUFNLElBQUk7SUFDbkQsTUFBTWUsU0FBU0YsUUFBUUcsT0FBTztJQUU5Qiw0Q0FBNEM7SUFDNUMsTUFBTUMsY0FBY0osUUFBUUssWUFBWTtJQUV4QyxJQUFJZCxRQUF1QjtJQUMzQixJQUFJVyxRQUFRO1FBQ1ZYLFFBQVEsTUFBTUgsbUVBQXFCQSxDQUFDYztJQUN0QztJQUNBLElBQUksQ0FBQ1gsU0FBU2EsYUFBYWIsUUFBUWE7SUFDbkMsSUFBSSxDQUFDYixPQUFPLE9BQU9RLElBQUlPLE1BQU0sQ0FBQyxLQUFLVixJQUFJLENBQUM7UUFBRVcsT0FBTztJQUFvQjtJQUVyRSxNQUFNQyxPQUFPLE1BQU1uQixlQUFlLG9EQUFvREU7SUFDdEZRLElBQUlPLE1BQU0sQ0FBQyxLQUFLVixJQUFJLENBQUNZO0FBQ3ZCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8va2V5ZmluZGVyLy4vcGFnZXMvYXBpL3Nwb3RpZnkvcGxheWxpc3RzL2luZGV4LnRzP2VjZWMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUgeyBOZXh0QXBpUmVxdWVzdCwgTmV4dEFwaVJlc3BvbnNlIH0gZnJvbSAnbmV4dCc7XHJcbmltcG9ydCBjb29raWUgZnJvbSAnY29va2llJztcclxuaW1wb3J0IHsgZ2V0QWNjZXNzVG9rZW5Gb3JVc2VyIH0gZnJvbSAnLi4vLi4vLi4vLi4vbGliL3Nwb3RpZnknO1xyXG5cclxuYXN5bmMgZnVuY3Rpb24gZmV0Y2hXaXRoVG9rZW4odXJsOiBzdHJpbmcsIHRva2VuOiBzdHJpbmcpIHtcclxuICBjb25zdCByZXNwID0gYXdhaXQgZmV0Y2godXJsLCB7IGhlYWRlcnM6IHsgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3Rva2VufWAgfSB9KTtcclxuICByZXR1cm4gcmVzcC5qc29uKCk7XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZXIocmVxOiBOZXh0QXBpUmVxdWVzdCwgcmVzOiBOZXh0QXBpUmVzcG9uc2UpIHtcclxuICBjb25zdCBjb29raWVzID0gY29va2llLnBhcnNlKHJlcS5oZWFkZXJzLmNvb2tpZSB8fCAnJyk7XHJcbiAgY29uc3QgdXNlcklkID0gY29va2llcy51c2VyX2lkIGFzIHN0cmluZyB8IHVuZGVmaW5lZDtcclxuXHJcbiAgLy8gbG9jYWwtZGV2IGZhbGxiYWNrIHRvIGFjY2Vzc190b2tlbiBjb29raWVcclxuICBjb25zdCBsb2NhbEFjY2VzcyA9IGNvb2tpZXMuYWNjZXNzX3Rva2VuIGFzIHN0cmluZyB8IHVuZGVmaW5lZDtcclxuXHJcbiAgbGV0IHRva2VuOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcclxuICBpZiAodXNlcklkKSB7XHJcbiAgICB0b2tlbiA9IGF3YWl0IGdldEFjY2Vzc1Rva2VuRm9yVXNlcih1c2VySWQpO1xyXG4gIH1cclxuICBpZiAoIXRva2VuICYmIGxvY2FsQWNjZXNzKSB0b2tlbiA9IGxvY2FsQWNjZXNzO1xyXG4gIGlmICghdG9rZW4pIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7IGVycm9yOiAnbm90X2F1dGhlbnRpY2F0ZWQnIH0pO1xyXG5cclxuICBjb25zdCBkYXRhID0gYXdhaXQgZmV0Y2hXaXRoVG9rZW4oJ2h0dHBzOi8vYXBpLnNwb3RpZnkuY29tL3YxL21lL3BsYXlsaXN0cz9saW1pdD01MCcsIHRva2VuKTtcclxuICByZXMuc3RhdHVzKDIwMCkuanNvbihkYXRhKTtcclxufVxyXG4iXSwibmFtZXMiOlsiY29va2llIiwiZ2V0QWNjZXNzVG9rZW5Gb3JVc2VyIiwiZmV0Y2hXaXRoVG9rZW4iLCJ1cmwiLCJ0b2tlbiIsInJlc3AiLCJmZXRjaCIsImhlYWRlcnMiLCJBdXRob3JpemF0aW9uIiwianNvbiIsImhhbmRsZXIiLCJyZXEiLCJyZXMiLCJjb29raWVzIiwicGFyc2UiLCJ1c2VySWQiLCJ1c2VyX2lkIiwibG9jYWxBY2Nlc3MiLCJhY2Nlc3NfdG9rZW4iLCJzdGF0dXMiLCJlcnJvciIsImRhdGEiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./pages/api/spotify/playlists/index.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fspotify%2Fplaylists&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cspotify%5Cplaylists%5Cindex.ts&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();